{
  "dashboard": {
    "id": null,
    "title": "🚀 Comprehensive API Server Monitoring",
    "description": "Complete monitoring dashboard for Kubernetes API server performance, errors, resources, and storage",
    "tags": ["kubernetes", "api-server", "performance", "comprehensive"],
    "timezone": "browser",
    "schemaVersion": 41,
    "version": 1,
    "refresh": "30s",
    "time": {
      "from": "now-6h",
      "to": "now"
    },
    "timepicker": {
      "refresh_intervals": ["30s", "1m", "5m", "15m", "30m", "1h"]
    },
    "templating": {
      "list": []
    },
    "panels": [
      {
        "id": 1,
        "title": "🚀 API Server Request Rate (QPS)",
        "type": "timeseries",
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 0},
        "targets": [
          {
            "expr": "sum(rate(apiserver_request_total[5m])) by (verb)",
            "legendFormat": "{{verb}}",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "custom": {
              "drawStyle": "line",
              "lineWidth": 2,
              "fillOpacity": 10,
              "showPoints": "never"
            },
            "unit": "reqps",
            "thresholds": {
              "steps": [
                {"color": "green", "value": 0},
                {"color": "yellow", "value": 50},
                {"color": "red", "value": 100}
              ]
            }
          }
        },
        "options": {
          "legend": {
            "displayMode": "table",
            "calcs": ["lastNotNull", "max"]
          }
        }
      },
             {
         "id": 2,
         "title": "🎯 API Server P99 & P95 Latency",
         "type": "timeseries",
         "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0},
         "targets": [
           {
             "expr": "histogram_quantile(0.99, sum(rate(apiserver_request_duration_seconds_bucket[5m])) by (verb, le))",
             "legendFormat": "P99 {{verb}}",
             "refId": "A"
           },
           {
             "expr": "histogram_quantile(0.95, sum(rate(apiserver_request_duration_seconds_bucket[5m])) by (verb, le))",
             "legendFormat": "P95 {{verb}}",
             "refId": "B"
           }
         ],
         "fieldConfig": {
           "defaults": {
             "custom": {
               "drawStyle": "line",
               "lineWidth": 2,
               "fillOpacity": 10,
               "showPoints": "never"
             },
             "unit": "s",
             "thresholds": {
               "steps": [
                 {"color": "green", "value": 0},
                 {"color": "yellow", "value": 1},
                 {"color": "red", "value": 5}
               ]
             }
           }
         },
         "options": {
           "legend": {
             "displayMode": "table",
             "calcs": ["lastNotNull", "max"]
           }
         }
       },
             {
         "id": 4,
         "title": "⚡ Average Request Latency",
         "type": "timeseries",
         "gridPos": {"h": 8, "w": 12, "x": 0, "y": 8},
        "targets": [
          {
            "expr": "sum(rate(apiserver_request_duration_seconds_sum[5m])) / sum(rate(apiserver_request_duration_seconds_count[5m]))",
            "legendFormat": "Overall Average",
            "refId": "A"
          },
          {
            "expr": "sum(rate(apiserver_request_duration_seconds_sum[5m])) by (verb) / sum(rate(apiserver_request_duration_seconds_count[5m])) by (verb)",
            "legendFormat": "Avg {{verb}}",
            "refId": "B"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "custom": {
              "drawStyle": "line",
              "lineWidth": 2,
              "fillOpacity": 10,
              "showPoints": "never"
            },
            "unit": "s"
          }
        },
        "options": {
          "legend": {
            "displayMode": "table",
            "calcs": ["lastNotNull", "max"]
          }
        }
      },
             {
         "id": 5,
         "title": "🚨 API Server Error Rate",
         "type": "timeseries",
         "gridPos": {"h": 8, "w": 12, "x": 12, "y": 8},
        "targets": [
          {
            "expr": "sum(rate(apiserver_request_total{code!~\"2..\"}[5m])) by (code)",
            "legendFormat": "{{code}} errors",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "custom": {
              "drawStyle": "line",
              "lineWidth": 2,
              "fillOpacity": 10,
              "showPoints": "never"
            },
            "unit": "reqps",
            "thresholds": {
              "steps": [
                {"color": "green", "value": 0},
                {"color": "yellow", "value": 0.1},
                {"color": "red", "value": 1}
              ]
            }
          }
        },
        "options": {
          "legend": {
            "displayMode": "table",
            "calcs": ["lastNotNull", "max"]
          }
        }
      },
             {
         "id": 6,
         "title": "💻 API Server Resource Usage",
         "type": "timeseries",
         "gridPos": {"h": 8, "w": 12, "x": 0, "y": 16},
        "targets": [
          {
            "expr": "rate(process_cpu_seconds_total{job=\"apiserver\"}[5m]) * 100",
            "legendFormat": "CPU %",
            "refId": "A"
          },
          {
            "expr": "process_resident_memory_bytes{job=\"apiserver\"} / 1024 / 1024",
            "legendFormat": "Resident Memory MB",
            "refId": "B"
          },
          {
            "expr": "go_memstats_alloc_bytes{job=\"apiserver\"} / 1024 / 1024",
            "legendFormat": "Go Heap Alloc MB",
            "refId": "C"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "custom": {
              "drawStyle": "line",
              "lineWidth": 2,
              "fillOpacity": 10,
              "showPoints": "never"
            }
          }
        },
        "options": {
          "legend": {
            "displayMode": "table",
            "calcs": ["lastNotNull", "max"]
          }
        }
      },
             {
         "id": 7,
         "title": "✅ API Server Status",
         "type": "stat",
         "gridPos": {"h": 4, "w": 6, "x": 12, "y": 16},
        "targets": [
          {
            "expr": "up{job=\"apiserver\"}",
            "legendFormat": "API Server Up",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "thresholds": {
              "steps": [
                {"color": "red", "value": 0},
                {"color": "green", "value": 1}
              ]
            },
            "mappings": [
              {"options": {"0": {"text": "DOWN"}}, "type": "value"},
              {"options": {"1": {"text": "UP"}}, "type": "value"}
            ]
          }
        },
        "options": {
          "reduceOptions": {"calcs": ["lastNotNull"]},
          "colorMode": "background"
        }
      },
             {
         "id": 8,
         "title": "🔄 Active Goroutines",
         "type": "stat",
         "gridPos": {"h": 4, "w": 6, "x": 18, "y": 16},
        "targets": [
          {
            "expr": "go_goroutines{job=\"apiserver\"}",
            "legendFormat": "Goroutines",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "thresholds": {
              "steps": [
                {"color": "green", "value": 0},
                {"color": "yellow", "value": 5000},
                {"color": "red", "value": 10000}
              ]
            }
          }
        },
        "options": {
          "reduceOptions": {"calcs": ["lastNotNull"]},
          "colorMode": "background"
        }
      },
             {
         "id": 9,
         "title": "📈 Error Rate %",
         "type": "stat",
         "gridPos": {"h": 4, "w": 6, "x": 12, "y": 20},
        "targets": [
          {
            "expr": "(sum(rate(apiserver_request_total{code!~\"2..\"}[5m])) / sum(rate(apiserver_request_total[5m]))) * 100",
            "legendFormat": "Error %",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "thresholds": {
              "steps": [
                {"color": "green", "value": 0},
                {"color": "yellow", "value": 0.5},
                {"color": "red", "value": 1}
              ]
            }
          }
        },
        "options": {
          "reduceOptions": {"calcs": ["lastNotNull"]},
          "colorMode": "background"
        }
      },
      {
        "id": 10,
        "title": "⚡ Current QPS",
        "type": "stat",
        "gridPos": {"h": 4, "w": 6, "x": 18, "y": 24},
        "targets": [
          {
            "expr": "sum(rate(apiserver_request_total[5m]))",
            "legendFormat": "Total QPS",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "reqps",
            "thresholds": {
              "steps": [
                {"color": "green", "value": 0},
                {"color": "yellow", "value": 50},
                {"color": "red", "value": 100}
              ]
            }
          }
        },
        "options": {
          "reduceOptions": {"calcs": ["lastNotNull"]},
          "colorMode": "background"
        }
      },
      {
        "id": 11,
        "title": "🔢 HTTP Verb Request Counts",
        "type": "timeseries",
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 28},
        "targets": [
          {
            "expr": "sum(apiserver_request_total) by (verb)",
            "legendFormat": "{{verb}} Total",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "custom": {
              "drawStyle": "line",
              "lineWidth": 2,
              "fillOpacity": 10,
              "showPoints": "never"
            },
            "unit": "short"
          }
        },
        "options": {
          "legend": {
            "displayMode": "table",
            "calcs": ["lastNotNull", "max"]
          }
        }
      },
      {
        "id": 12,
        "title": "📦 Total Objects Over Time",
        "type": "timeseries",
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 28},
        "targets": [
          {
            "expr": "sum(apiserver_storage_objects)",
            "legendFormat": "Total Objects in API Server",
            "refId": "A"
          },
          {
            "expr": "sum(etcd_debugging_mvcc_keys_total)",
            "legendFormat": "Total Keys in Etcd",
            "refId": "B"
          },
          {
            "expr": "count(kube_pod_info)",
            "legendFormat": "Total Pods",
            "refId": "C"
          },
          {
            "expr": "count(kube_service_info)",
            "legendFormat": "Total Services",
            "refId": "D"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "custom": {
              "drawStyle": "line",
              "lineWidth": 2,
              "fillOpacity": 10,
              "showPoints": "never"
            },
            "unit": "short"
          }
        },
        "options": {
          "legend": {
            "displayMode": "table",
            "calcs": ["lastNotNull", "max"]
          }
        }
      },
      {
        "id": 13,
        "title": "🗂️ Objects by Resource Type",
        "type": "timeseries",
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 36},
        "targets": [
          {
            "expr": "apiserver_storage_objects",
            "legendFormat": "{{resource}} Objects",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "custom": {
              "drawStyle": "line",
              "lineWidth": 2,
              "fillOpacity": 10,
              "showPoints": "never"
            },
            "unit": "short"
          }
        },
        "options": {
          "legend": {
            "displayMode": "table",
            "calcs": ["lastNotNull", "max"]
          }
        }
      },
      {
        "id": 14,
        "title": "🧠 Memory Allocation Rate",
        "type": "timeseries",
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 36},
        "targets": [
          {
            "expr": "rate(go_memstats_mallocs_total{job=\"apiserver\"}[5m])",
            "legendFormat": "Allocations/sec",
            "refId": "A"
          },
          {
            "expr": "rate(go_memstats_frees_total{job=\"apiserver\"}[5m])",
            "legendFormat": "Frees/sec",
            "refId": "B"
          },
          {
            "expr": "go_memstats_heap_objects{job=\"apiserver\"}",
            "legendFormat": "Heap Objects",
            "refId": "C"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "custom": {
              "drawStyle": "line",
              "lineWidth": 2,
              "fillOpacity": 10,
              "showPoints": "never"
            },
            "thresholds": {
              "steps": [
                {"color": "green", "value": 0},
                {"color": "yellow", "value": 10000},
                {"color": "red", "value": 50000}
              ]
            }
          }
        },
        "options": {
          "legend": {
            "displayMode": "table",
            "calcs": ["lastNotNull", "max"]
          }
        }
      },
      {
        "id": 15,
        "title": "🗑️ Garbage Collection Performance",
        "type": "timeseries",
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 44},
        "targets": [
          {
            "expr": "rate(go_gc_duration_seconds_sum{job=\"apiserver\"}[5m])",
            "legendFormat": "GC Duration/sec",
            "refId": "A"
          },
          {
            "expr": "go_memstats_gc_cpu_fraction{job=\"apiserver\"} * 100",
            "legendFormat": "GC CPU %",
            "refId": "B"
          },
          {
            "expr": "rate(go_memstats_gc_total{job=\"apiserver\"}[5m])",
            "legendFormat": "GC Cycles/sec",
            "refId": "C"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "custom": {
              "drawStyle": "line",
              "lineWidth": 2,
              "fillOpacity": 10,
              "showPoints": "never"
            },
            "thresholds": {
              "steps": [
                {"color": "green", "value": 0},
                {"color": "yellow", "value": 25},
                {"color": "red", "value": 50}
              ]
            }
          }
        },
        "options": {
          "legend": {
            "displayMode": "table",
            "calcs": ["lastNotNull", "max"]
          }
        }
      },
      {
        "id": 16,
        "title": "💾 Etcd Storage Performance",
        "type": "timeseries",
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 44},
        "targets": [
          {
            "expr": "etcd_mvcc_db_total_size_in_bytes / 1024 / 1024",
            "legendFormat": "Etcd DB Size (MB)",
            "refId": "A"
          },
          {
            "expr": "histogram_quantile(0.95, sum(rate(etcd_request_duration_seconds_bucket[5m])) by (operation, le))",
            "legendFormat": "P95 {{operation}} Duration",
            "refId": "B"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "custom": {
              "drawStyle": "line",
              "lineWidth": 2,
              "fillOpacity": 10,
              "showPoints": "never"
            }
          }
        },
        "options": {
          "legend": {
            "displayMode": "table",
            "calcs": ["lastNotNull", "max"]
          }
        }
      }
    ]
  },
  "overwrite": true,
  "message": "Comprehensive API Server Monitoring Dashboard - Complete performance, error, resource, and storage tracking"
} 